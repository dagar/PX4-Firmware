

# parameters to auto start
#  mode (normal, minimal)
#  UDP port
#  max rate
#  DDS DOMAIN ID
#


# multiple instances?


module_name: Micro XRCE-DDS
serial_config:
    - command: |
        if [ $SERIAL_DEV != ethernet ]; then
            set XRCE_DDS_ARGS "-d ${SERIAL_DEV} -b p:${BAUD_PARAM} -m p:MAV_${i}_MODE -r p:MAV_${i}_RATE"
        else
            set XRCE_DDS_ARGS "-u p:MAV_${i}_UDP_PRT -o p:MAV_${i}_REMOTE_PRT -m p:MAV_${i}_MODE -r p:MAV_${i}_RATE"
            if param compare MAV_${i}_BROADCAST 1
            then
                set XRCE_DDS_ARGS "${XRCE_DDS_ARGS} -p"
            fi
        fi
        microdds_client start ${XRCE_DDS_ARGS} -x
      port_config_param:
        name: XRCE_DDS_${i}_CONFIG
        group: Micro XRCE-DDS
        # MAVLink instances:
        # 0: Telem1 Port (Telemetry Link)
        # 1: Telem2 Port (Companion Link). Disabled by default to reduce RAM usage
        # 2: Board-specific / no fixed function or port
        default: [TEL1, "", ""]
      supports_networking: true


parameters:
    - group: Micro XRCE-DDS
      definitions:

        XRCE_DDS_DOMAIN_ID:
            description:
                short: Accelerometer ${i} calibration device ID
                long: Device ID of the accelerometer this calibration applies to.
            category: System
            type: int32
            default: 0

        XRCE_DDS_UDP_EN:
            description:
                short: Accelerometer ${i} calibration device ID
                long: Device ID of the accelerometer this calibration applies to.
            category: System
            type: int32
            default: 0
